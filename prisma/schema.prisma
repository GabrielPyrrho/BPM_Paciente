generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Entidade {
  id        String   @id @default(cuid())
  nome      String
  tipo      String   // PESSOA, EMPRESA, DOCUMENTO
  campos    Json?    // Campos dinâmicos específicos por tipo
  processos ProcessoWorkflow[]
}

model TipoWorkflow {
  id          String   @id @default(cuid())
  nome        String   // HC24, HC48, NotaFiscal, Contrato
  descricao   String?
  categoria   String?  // HOSPITALAR, FINANCEIRO, JURIDICO
  atividades  TipoWorkflowAtividade[]
  processos   ProcessoWorkflow[]
}

model Etapa {
  id          String   @id @default(cuid())
  nome        String   // CAPTACAO, PRE_INTERNAMENTO, INTERNADO
  descricao   String?
  ordem       Int
  cor         String?  // Para visualização
  atividades  AtividadeTemplate[]
}

model AtividadeTemplate {
  id            String   @id @default(cuid())
  nome          String
  setor         String?
  setorId       String?
  setorObj      Setor?   @relation(fields: [setorId], references: [id])
  ordem         Int
  etapaId       String
  etapa         Etapa    @relation(fields: [etapaId], references: [id])
  tipos         TipoWorkflowAtividade[]
  movimentacoes MovimentacaoWorkflow[]
}

model TipoWorkflowAtividade {
  id             String   @id @default(cuid())
  tipoWorkflowId String
  atividadeId    String
  tipoWorkflow   TipoWorkflow      @relation(fields: [tipoWorkflowId], references: [id])
  atividade      AtividadeTemplate @relation(fields: [atividadeId], references: [id])
}

model ProcessoWorkflow {
  id             String   @id @default(cuid())
  entidadeId     String
  tipoWorkflowId String
  entidade       Entidade     @relation(fields: [entidadeId], references: [id])
  tipoWorkflow   TipoWorkflow @relation(fields: [tipoWorkflowId], references: [id])
  atividades     MovimentacaoWorkflow[]
}

model MovimentacaoWorkflow {
  id                  String   @id @default(cuid())
  processoId          String
  processo            ProcessoWorkflow @relation(fields: [processoId], references: [id])
  atividadeId         String
  atividade           AtividadeTemplate @relation(fields: [atividadeId], references: [id])
  responsavelId       String?
  responsavel         Usuario?  @relation(fields: [responsavelId], references: [id])
  responsavelCompleto String?  // Nome + Setor do responsável
  status              String   // OK | NOK | PENDENTE
  prazo               DateTime?
  horaInicio          DateTime?
  horaFim             DateTime?
  observacao          String?
}

model Setor {
  id          String   @id @default(cuid())
  nome        String   @unique
  descricao   String?
  ativo       Boolean  @default(true)
  usuarios    Usuario[]
  atividades  AtividadeTemplate[]
}

model Usuario {
  id            String   @id @default(cuid())
  nome          String
  email         String   @unique
  senha         String
  funcao        String?
  setorId       String?
  setor         Setor?   @relation(fields: [setorId], references: [id])
  ativo         Boolean  @default(true)
  movimentacoes MovimentacaoWorkflow[]
}